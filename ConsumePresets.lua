-- ============================================================================
-- SLACKSPOTTER - CONSUME PRESETS (COMPACT FORMAT)
-- Format: "Raid|Spec|ID1,ID2,ID3|anyX" or "Raid|Spec|ID1,ID2|" (empty = check all)
-- ============================================================================

SS_ConsumePresets_Compact = {
    -- ========================================================================
    -- MOLTEN CORE (MC)
    -- ========================================================================
    "MC|WarriorDPS|1,5,27,28|any2",
    "MC|WarriorTank|1,7|",
    "MC|PaladinRetri|1,5,27,28|any2",
    "MC|PaladinHoly|3,12,13|any2",
    "MC|PaladinTank|1,7|",
    "MC|HunterSurv|5,27,28|any2",
    "MC|HunterMM|5,27,28|any2",
    "MC|ShamanEnhDPS|1,5,27,28|any2",
    "MC|ShamanEle (Nat)|2,8,23|any2",
    "MC|ShamanEle (Fire)|2,8,23|any2",
    "MC|ShamanResto|3,12,13|any2",
    "MC|ShamanEnhTank|1,7|",
    "MC|RogueDPS|5,27,28,29|any3",
    "MC|DruidCat|5,27,28|any2",
    "MC|DruidOwl|2,8,9|any2",
    "MC|DruidTree|3,12,13|any2",
    "MC|DruidBear|1,7|",
    "MC|PriestDisc|3,12,13|any2",
    "MC|PriestShadow|2,11,13|any2",
    "MC|PriestHoly|3,12,13|any2",
    "MC|WarlockShadow|2,11,13|any2",
    "MC|WarlockFire|2,8,13|any2",
    "MC|MageArcane|2,9,13|any2",
    "MC|MageFire|2,8,13|any2",
    "MC|MageFrost|2,10,13|any2",
    
    -- ========================================================================
    -- BLACKWING LAIR (BWL)
    -- ========================================================================
    "BWL|WarriorDPS|1,5,27,28|any3",
    "BWL|WarriorTank|1,7|",
    "BWL|PaladinRetri|1,5,27,28|any3",
    "BWL|PaladinHoly|3,12,13|any2",
    "BWL|PaladinTank|1,7|",
    "BWL|HunterSurv|5,27,28|any2",
    "BWL|HunterMM|5,27,28|any2",
    "BWL|ShamanEnhDPS|1,5,27,28|any3",
    "BWL|ShamanEle (Nat)|2,8,23|any2",
    "BWL|ShamanEle (Fire)|2,8,23|any2",
    "BWL|ShamanResto|3,12,13|any2",
    "BWL|ShamanEnhTank|1,7|",
    "BWL|RogueDPS|5,27,28,29|any3",
    "BWL|DruidCat|5,27,28|any2",
    "BWL|DruidOwl|2,8,9|any2",
    "BWL|DruidTree|3,12,13|any2",
    "BWL|DruidBear|1,7|",
    "BWL|PriestDisc|3,12,13|any2",
    "BWL|PriestShadow|2,11,13|any2",
    "BWL|PriestHoly|3,12,13|any2",
    "BWL|WarlockShadow|2,11,13|any2",
    "BWL|WarlockFire|2,8,13|any2",
    "BWL|MageArcane|2,9,13|any2",
    "BWL|MageFire|2,8,13|any2",
    "BWL|MageFrost|2,10,13|any2",
    
    -- ========================================================================
    -- NAXXRAMAS (Naxx)
    -- ========================================================================
    "Naxx|WarriorDPS|1,5,27,28|",
    "Naxx|WarriorTank|1,7|",
    "Naxx|PaladinRetri|1,5,27,28|",
    "Naxx|PaladinHoly|3,12,13|any2",
    "Naxx|PaladinTank|1,7|",
    "Naxx|HunterSurv|5,27,28|",
    "Naxx|HunterMM|5,27,28|",
    "Naxx|ShamanEnhDPS|1,5,27,28|",
    "Naxx|ShamanEle (Nat)|2,8,23|any2",
    "Naxx|ShamanEle (Fire)|2,8,23|any2",
    "Naxx|ShamanResto|3,12,13|any2",
    "Naxx|ShamanEnhTank|1,7|",
    "Naxx|RogueDPS|5,27,28,29|",
    "Naxx|DruidCat|5,27,28|",
    "Naxx|DruidOwl|2,8,9|any2",
    "Naxx|DruidTree|3,12,13|any2",
    "Naxx|DruidBear|1,7|",
    "Naxx|PriestDisc|3,12,13|any2",
    "Naxx|PriestShadow|2,11,13|any2",
    "Naxx|PriestHoly|3,12,13|any2",
    "Naxx|WarlockShadow|2,11,13|any2",
    "Naxx|WarlockFire|2,8,13|any2",
    "Naxx|MageArcane|2,9,13|any2",
    "Naxx|MageFire|2,8,13|any2",
    "Naxx|MageFrost|2,10,13|any2",
    
    -- ========================================================================
    -- KARAZHAN 40 (Kara40)
    -- ========================================================================
    "Kara40|WarriorDPS|1,5,27,28|any3",
    "Kara40|WarriorTank|1,7|",
    "Kara40|PaladinRetri|1,5,27,28|any3",
    "Kara40|PaladinHoly|3,12,13|any2",
    "Kara40|PaladinTank|1,7|",
    "Kara40|HunterSurv|5,27,28|any2",
    "Kara40|HunterMM|5,27,28|any2",
    "Kara40|ShamanEnhDPS|1,5,27,28|any3",
    "Kara40|ShamanEle (Nat)|2,8,23|any2",
    "Kara40|ShamanEle (Fire)|2,8,23|any2",
    "Kara40|ShamanResto|3,12,13|any2",
    "Kara40|ShamanEnhTank|1,7|",
    "Kara40|RogueDPS|5,27,28,29|any3",
    "Kara40|DruidCat|5,27,28|any2",
    "Kara40|DruidOwl|2,8,9|any2",
    "Kara40|DruidTree|3,12,13|any2",
    "Kara40|DruidBear|1,7|",
    "Kara40|PriestDisc|3,12,13|any2",
    "Kara40|PriestShadow|2,11,13|any2",
    "Kara40|PriestHoly|3,12,13|any2",
    "Kara40|WarlockShadow|2,11,13|any2",
    "Kara40|WarlockFire|2,8,13|any2",
    "Kara40|MageArcane|2,9,13|any2",
    "Kara40|MageFire|2,8,13|any2",
    "Kara40|MageFrost|2,10,13|any2",
    
    -- ========================================================================
    -- KARAZHAN 10 (Kara10) - TODO
    -- ========================================================================
    -- "Kara10|WarriorDPS||",
    
    -- ========================================================================
    -- EMERALD SANCTUM (ES) - TODO
    -- ========================================================================
    -- "ES|WarriorDPS||",
    
    -- ========================================================================
    -- AQ20 - TODO
    -- ========================================================================
    -- "AQ20|WarriorDPS||",
    
    -- ========================================================================
    -- ZULGURUB (ZG) - TODO
    -- ========================================================================
    -- "ZG|WarriorDPS||",
    
    -- ========================================================================
    -- ONYXIA (Ony) - TODO
    -- ========================================================================
    -- "Ony|WarriorDPS||",
}

-- ============================================================================
-- PARSER: Convert compact format to full structure
-- ============================================================================

function SS_ConsumePresets_Parse()
    local parsed = {}
    
    for i = 1, table.getn(SS_ConsumePresets_Compact) do
        local line = SS_ConsumePresets_Compact[i]
        
        -- Split by |
        local parts = {}
        for part in string.gfind(line, "[^|]+") do
            table.insert(parts, part)
        end
        
        if table.getn(parts) >= 3 then
            local raid = parts[1]
            local spec = parts[2]
            local consumeIDs = parts[3]
            local minReq = parts[4] or ""
            
            -- Parse consume IDs
            local consumes = {}
            if consumeIDs and consumeIDs ~= "" then
                for idStr in string.gfind(consumeIDs, "[^,]+") do
                    local id = tonumber(idStr)
                    if id and SS_ConsumeData_IDMapping[id] then
                        table.insert(consumes, SS_ConsumeData_IDMapping[id])
                    else
                        DEFAULT_CHAT_FRAME:AddMessage("|cffff0000Preset error: Unknown consume ID " .. (idStr or "nil") .. " in " .. raid .. "/" .. spec .. "|r")
                    end
                end
            end
            
            -- Parse minRequired
            local minRequired = 0
            if minReq and minReq ~= "" then
                local anyNum = string.match(minReq, "any(%d+)")
                if anyNum then
                    minRequired = tonumber(anyNum) or 0
                end
            end
            
            -- Store in parsed structure
            if not parsed[raid] then
                parsed[raid] = {}
            end
            
            parsed[raid][spec] = {
                consumes = consumes,
                minRequired = minRequired
            }
        end
    end
    
    return parsed
end

-- Parse on load
SS_ConsumePresets = SS_ConsumePresets_Parse()